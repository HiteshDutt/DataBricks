name: CI CD

on:
  push:
    branches:
    - main
    - dev
    
env:
  DEV_BRANCH: refs/heads/dev
  PROD_BRANCH: refs/heads/main
  
jobs:
  Build:
    name: Build Job
    runs-on: windows-latest
    steps:
    - name: Checkout
      uses: actions/checkout@v2.4.2
    - name: Upload Build Artifacts
      uses: actions/upload-artifact@v3.1.0
      with:
        path: ${{ github.workspace }}/notebooks/Shared/
        name: drop
  DeployDev:
    needs: [Build]
    name: DEV Deployment
    runs-on: windows-latest
    environment:
      name: Dev  
    steps:
    - name: install Databrick CLI
      uses: microsoft/install-databricks-cli@v1.0.0
    - name: Upload Databricks
      uses: microsoft/databricks-import-notebook@v1.0.0
      with:
        # Databricks host
        databricks-host: $DATABRICKSHOST
        # Databricks token
        databricks-token: $TOKEN
        # LOCAL_NOTEBOOKS_PATH
        local-path: ./
        # REMOTE_NOTEBOOK_PATH
        remote-path: $REMOTEPATH
  DeployProd:
    needs: [DeployDev]
    name: Prod Deployment
    runs-on: windows-latest
    environment:
      name: Prod  
    steps:
    - name: install Databrick CLI
      uses: microsoft/install-databricks-cli@v1.0.0
    - name: Upload Databricks
      uses: microsoft/databricks-import-notebook@v1.0.0
      with:
        # Databricks host
        databricks-host: $DATABRICKSHOST
        # Databricks token
        databricks-token: $TOKEN
        # LOCAL_NOTEBOOKS_PATH
        local-path: ./
        # REMOTE_NOTEBOOK_PATH
        remote-path: $REMOTEPATH
